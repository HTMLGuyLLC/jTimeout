/* 
	*
	*
	jTimeout v.2.1
	Made with love by Versatility Werks (http://flwebsites.biz)
	MIT Licensed
	*
	*
*/
!function(t){t.jTimeout=function(e){var o=this,n=!1,i=!1;o.options=t.extend({},t.jTimeout.defaults,e),o.generateUid=function(t){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var o=t||"-";return e()+e()+o+e()+o+e()+o+e()+o+e()+e()+e()},o.getTimer=function(){return window.localStorage.getItem("timeoutCountdown")},o.setTimer=function(t){return window.localStorage.setItem("timeoutCountdown",t)},o.getTab=function(){return window.localStorage.getItem("timeoutTab")},o.setTab=function(t){return window.localStorage.setItem("timeoutTab",t)},o.getTabLast=function(){return window.localStorage.getItem("timeoutTabLast")},o.setTabLast=function(){return window.localStorage.setItem("timeoutTabLast",new Date)},o.stopPriorCountdown=function(){o.priorCountDown&&(o.priorCountDown=!1)},o.resetOnAlert=function(){return o.options.triggerResetOnAlert?0==t("#jTimedoutAlert").length&&o.options.triggerResetOnAlert:0==t("#jTimeoutAlert").length&&0==t("#jTimedoutAlert").length},o.stopFlashing=function(){o.options.flashTitle&&(o.flashingTitle&&window.clearInterval(o.flashingTitle),o.flashingTitle=!1,document.title=o.options.originalTitle)},o.startFlashing=function(){!o.flashingTitle&&o.options.flashTitle&&(o.flashingTitle=window.setInterval(function(){document.title=document.title==o.options.flashingTitleText?o.options.originalTitle:o.options.flashingTitleText},o.options.flashTitleSpeed))},o.startPriorCountdown=function(t){o.priorCountDown=t},o.hideAlerts=function(){var e=t("#jTimeoutAlert"),o=t("#jTimedoutAlert");e.length>0&&e.closeAlert(),o.length>0&&o.closeAlert()},o.countdown=function(){var e=o.getTimer(),s=o.getTab(),r=o.getTabLast();r<new Date("-2 seconds")&&(e-=Math.abs(((new Date).getTime()-r.getTime())/1e3),s=o.options.tabID,o.setTab(s)),o.priorCountDown&&o.priorCountDown.text(e),s==o.options.tabID&&(e-=o.options.heartbeat,o.setTabLast(),o.setTimer(e)),0>e&&!n?(i=!0,n=!0,o.options.onTimeout?o.options.onTimeout(o):(t.jAlert({id:"jTimedoutAlert",title:"Oh No!",content:"<b>Your session has timed out.</b>",theme:"red",btns:{text:"Login Again",href:o.options.loginUrl,theme:"blue",closeAlert:!1},closeOnClick:!1,closeBtn:!1,closeOnEsc:!1,replaceOtherAlerts:!0}),t.get(o.options.logoutUrl))):e<o.options.secondsPrior&&!i?(i=!0,o.startFlashing(),o.options.onPriorCallback?o.options.onPriorCallback(o):t.jAlert({id:"jTimeoutAlert",title:"Oh No!",content:'<b>Your session will timeout in <span class="jTimeout_Countdown">'+e+"</span> seconds!</b>",theme:"red",closeBtn:!1,onOpen:function(t){o.startPriorCountdown(t.find(".jTimeout_Countdown"))},btns:[{text:"Extend my Session",theme:"blue",onClick:function(e,n){return e.preventDefault(),o.options.onClickExtend?o.options.onClickExtend(o):(t.get(o.options.extendUrl),o.setTimer(o.options.timeoutAfter),o.setTab(o.options.tabID),o.setTabLast()),n.parents(".jAlert").closeAlert(),!1}},{text:"Logout Now",onClick:function(t){return t.preventDefault(),window.location.href=o.options.logoutUrl,!1}}]})):e>o.options.secondsPrior&&(i||n)&&(o.stopFlashing(),o.stopPriorCountdown(),o.hideAlerts(),i=!1,n=!1)},o.options.tabID||(o.options.tabID=o.generateUid()),o.setTimer(o.options.timeoutAfter),o.setTab(o.options.tabID),o.setTabLast();var s=1e3*o.options.heartbeat;return setInterval(o.countdown,s),o.options.extendOnMouseMove&&(s=1e3*o.options.mouseDebounce,o.mouseMoved=!1,window.setTimeout(function(){t("body").on("mousemove",function(){!o.mouseMoved&&o.resetOnAlert()&&(o.mouseMoved=!0,window.setTimeout(function(){o.mouseMoved=!1},s),o.onMouseMove?o.options.onMouseMove():(t.get(o.options.extendUrl),o.setTimer(o.options.timeoutAfter),o.setTab(o.options.tabID),o.setTabLast()))})},s)),this},t.jTimeout.reset=function(e){e="undefined"!=typeof e?e:t.jTimeout.defaults.timeoutAfter,window.localStorage.timeoutCountdown=e},t.jTimeout.defaults={flashTitle:!0,flashTitleSpeed:500,flashingTitleText:"**WARNING**",originalTitle:document.title,tabID:!1,timeoutAfter:1440,heartbeat:1,extendOnMouseMove:!0,mouseDebounce:30,onMouseMove:!1,extendUrl:"/dashboard",logoutUrl:"/logout",loginUrl:"/login",secondsPrior:60,triggerResetOnAlert:!1,onPriorCallback:!1,onClickExtend:!1,onTimeout:!1}}(jQuery);
