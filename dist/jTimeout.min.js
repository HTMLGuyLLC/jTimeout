/*
 *
 *
 jTimeout v3
 Made with love by HTMLGuy, LLC
 MIT Licensed
 *
 *
 */
(function(a){a.jTimeout=function(b){if("undefined"!=typeof window.jTimeout)return window.jTimeout;b=a.extend({},a.jTimeout.defaults,b);var c={expiration_key:"jtimeout-session-expiration",timedOut:!1,timeoutWarning:!1,interval:!1,mouseTimeout:!1,options:b,get:function(a){return window.localStorage.getItem(a)},set:function(a,b){return window.localStorage.setItem(a,b)},getExpiration:function(){return this.get(this.expiration_key)},setExpiration:function(a){var b=new Date;return b.setSeconds(b.getSeconds()+a),this.set(this.expiration_key,b)},resetExpiration:function(){return this.setExpiration(this.options.timeoutAfter),this},getSecondsTillExpiration:function(){var a=Math.round((new Date(this.getExpiration()).getTime()-new Date().getTime())/1e3);return 0>=a?0:a},stopPriorCountdown:function(){c.priorCountDown&&(c.priorCountDown=!1)},resetOnAlert:function(){return c.options.triggerResetOnAlert?0===a("#jTimedoutAlert").length&&c.options.triggerResetOnAlert:0===a("#jTimeoutAlert").length&&0===a("#jTimedoutAlert").length},stopFlashing:function(){c.options.flashTitle&&(c.flashingTitle&&window.clearInterval(c.flashingTitle),c.flashingTitle=!1,document.title=c.options.originalTitle)},startFlashing:function(){!c.flashingTitle&&c.options.flashTitle&&(c.flashingTitle=window.setInterval(function(){document.title=document.title===c.options.flashingTitleText?c.options.originalTitle:c.options.flashingTitleText},c.options.flashTitleSpeed))},startPriorCountdown:function(a){c.priorCountDown=a},hideCountdownAlert:function(){c.timeoutWarning=!1;var b=a("#jTimeoutAlert");0<b.length&&b.closeAlert()},setMouseTimeout:function(a){this.mouseTimeout=a},stopMouseTimeout:function(){this.mouseTimeout&&window.clearTimeout(this.mouseTimeout)},stopActivityMonitoring:function(){c.stopMouseTimeout()},startActivityMonitoring:function(){c.stopActivityMonitoring(),c.options.extendOnMouseMove&&(d=1e3*c.options.mouseDebounce,c.mouseMoved=!1,c.setMouseTimeout(window.setTimeout(function(){a("body").on("mousemove.jTimeout",function(){!c.mouseMoved&&c.resetOnAlert()&&(c.mouseMoved=!0,c.setMouseTimeout(window.setTimeout(function(){c.mouseMoved=!1},d)),c.options.onMouseMove(c))})},d)))},setCountdown:function(a){this.interval=a},countdown:function(){var a=c.getExpiration(),b=c.getSecondsTillExpiration();c.priorCountDown&&c.priorCountDown.text(b),0>=b&&!c.timedOut?(c.timeoutWarning=!0,c.timedOut=!0,c.options.onTimeout(c),c.stopActivityMonitoring()):0<b&&c.timedOut?(c.timeoutWarning=!1,c.timedOut=!1,c.options.onSessionExtended(c),c.startActivityMonitoring()):b<c.options.secondsPrior&&!c.timeoutWarning?(c.timeoutWarning=!0,c.startFlashing(),c.options.onPriorCallback(c,b)):b>=c.options.secondsPrior&&c.timeoutWarning&&(c.stopFlashing(),c.stopPriorCountdown(),c.hideCountdownAlert())},destroy:function(){c.stopFlashing(),c.stopActivityMonitoring(),delete c.options.onSessionExtended,delete c.countdown,a("body").off("mousemove.jTimeout")}};c.resetExpiration();var d=1e3*c.options.heartbeat;return c.setCountdown(window.setInterval(c.countdown,d)),c.startActivityMonitoring(),window.jTimeout=c,c},a.jTimeout.reset=function(b){var c="undefined"==typeof b?a.jTimeout.defaults.timeoutAfter:b;a.jTimeout().setExpiration(c)},a.jTimeout.defaults={flashTitle:!0,flashTitleSpeed:500,flashingTitleText:"**WARNING**",originalTitle:document.title,timeoutAfter:1440,heartbeat:1,extendOnMouseMove:!0,mouseDebounce:30,onMouseMove:function(b){a.get({url:b.options.extendUrl,cache:!1,success:function(){b.resetExpiration()}})},extendUrl:"/dashboard",logoutUrl:"/logout",loginUrl:"/login",secondsPrior:60,triggerResetOnAlert:!1,onPriorCallback:function(b,c){a.jAlert({id:"jTimeoutAlert",title:"Oh No!",content:"<b>Your session will timeout in <span class=\"jTimeout_Countdown\">"+c+"</span> seconds!</b>",theme:"red",closeBtn:!1,onOpen:function(a){b.startPriorCountdown(a.find(".jTimeout_Countdown"))},btns:[{text:"Extend my Session",theme:"blue",onClick:function(a,c){return a.preventDefault(),b.options.onClickExtend(b),c.parents(".jAlert").closeAlert(),!1}},{text:"Logout Now",onClick:function(a){return a.preventDefault(),window.location.href=b.options.logoutUrl,!1}}]})},onClickExtend:function(b){a.get({url:b.options.extendUrl,cache:!1}),b.resetExpiration()},onTimeout:function(b){a.jAlert({id:"jTimedoutAlert",title:"Oh No!",content:"<b>Your session has timed out.</b>",theme:"red",btns:{text:"Login Again",href:b.options.loginUrl,theme:"blue",closeAlert:!1},closeOnClick:!1,closeBtn:!1,closeOnEsc:!1}),a.get(b.options.logoutUrl)},onSessionExtended:function(){a("#jTimedoutAlert").closeAlert()}}})(jQuery);