/*
 *
 *
 jTimeout 2.1
 Made with love by Versatility Werks (http://flwebsites.biz)
 MIT Licensed
 *
 *
 */
!function(t){t.jTimeout=function(e){if(void 0!==window.jTimeout)return window.jTimeout;var o={timedOut:!1,timeoutWarning:!1,interval:!1,mouseTimeout:!1,options:e=t.extend({},t.jTimeout.defaults,e),generateUid:function(t){var e=t||"-";return this.S4()+this.S4()+e+this.S4()+e+this.S4()+e+this.S4()+e+this.S4()+this.S4()+this.S4()},S4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},get:function(t){return window.localStorage.getItem(t)},set:function(t,e){return window.localStorage.setItem(t,e)},getTimer:function(){return this.get("timeoutCountdown")},setTimer:function(t){return this.set("timeoutCountdown",t)},getTab:function(){return this.get("timeoutTab")},setTab:function(t){return this.set("timeoutTab",t)},getTabLast:function(){return this.get("timeoutTabLast")},setTabLast:function(){return this.set("timeoutTabLast",new Date)},stopPriorCountdown:function(){o.priorCountDown&&(o.priorCountDown=!1)},resetOnAlert:function(){return o.options.triggerResetOnAlert?0===t("#jTimedoutAlert").length&&o.options.triggerResetOnAlert:0===t("#jTimeoutAlert").length&&0===t("#jTimedoutAlert").length},stopFlashing:function(){o.options.flashTitle&&(o.flashingTitle&&window.clearInterval(o.flashingTitle),o.flashingTitle=!1,document.title=o.options.originalTitle)},startFlashing:function(){!o.flashingTitle&&o.options.flashTitle&&(o.flashingTitle=window.setInterval(function(){document.title===o.options.flashingTitleText?document.title=o.options.originalTitle:document.title=o.options.flashingTitleText},o.options.flashTitleSpeed))},startPriorCountdown:function(t){o.priorCountDown=t},hideCountdownAlert:function(){o.timeoutWarning=!1;var e=t("#jTimeoutAlert");e.length>0&&e.closeAlert()},setMouseTimeout:function(t){this.mouseTimeout=t},stopMouseTimeout:function(){this.mouseTimeout&&window.clearTimeout(this.mouseTimeout)},setCountdown:function(t){this.interval=t},stopCountdown:function(){this.interval&&window.clearInterval(this.interval)},countdown:function(){var t=o.getTimer(),e=o.getTab(),n=o.getTabLast();n<new Date("-2 seconds")&&(t-=Math.abs(((new Date).getTime()-n.getTime())/1e3),e=o.options.tabID,o.setTab(e)),o.priorCountDown&&o.priorCountDown.text(t),e===o.options.tabID&&(t-=o.options.heartbeat,o.setTabLast(),o.setTimer(t)),t<=0&&!o.timedOut?(o.timeoutWarning=!0,o.timedOut=!0,o.options.onTimeout(o),o.stopCountdown(),o.stopMouseTimeout(),o.setTimer(0)):t<o.options.secondsPrior&&!o.timeoutWarning?(o.timeoutWarning=!0,o.startFlashing(),o.options.onPriorCallback(o,t)):t>=o.options.secondsPrior&&o.timeoutWarning&&(o.stopFlashing(),o.stopPriorCountdown(),o.hideCountdownAlert())}};o.options.tabID||(o.options.tabID=o.generateUid()),o.setTimer(o.options.timeoutAfter),o.setTab(o.options.tabID),o.setTabLast();var n=1e3*o.options.heartbeat;return o.setCountdown(window.setInterval(o.countdown,n)),o.options.extendOnMouseMove&&(n=1e3*o.options.mouseDebounce,o.mouseMoved=!1,o.setMouseTimeout(window.setTimeout(function(){t("body").on("mousemove",function(){!o.mouseMoved&&o.resetOnAlert()&&(o.mouseMoved=!0,o.setMouseTimeout(window.setTimeout(function(){o.mouseMoved=!1},n)),o.options.onMouseMove(o))})},n))),window.jTimeout=o,o},t.jTimeout.reset=function(e){e=void 0!==e?e:t.jTimeout.defaults.timeoutAfter,t.jTimeout().set("timeoutCountdown",e)},t.jTimeout.defaults={flashTitle:!0,flashTitleSpeed:500,flashingTitleText:"**WARNING**",originalTitle:document.title,tabID:!1,timeoutAfter:1440,heartbeat:1,extendOnMouseMove:!0,mouseDebounce:30,onMouseMove:function(e){t.get(e.options.extendUrl),e.setTimer(e.options.timeoutAfter),e.setTab(e.options.tabID),e.setTabLast()},extendUrl:"/dashboard",logoutUrl:"/logout",loginUrl:"/login",secondsPrior:60,triggerResetOnAlert:!1,onPriorCallback:function(e,o){t.jAlert({id:"jTimeoutAlert",title:"Oh No!",content:'<b>Your session will timeout in <span class="jTimeout_Countdown">'+o+"</span> seconds!</b>",theme:"red",closeBtn:!1,onOpen:function(t){e.startPriorCountdown(t.find(".jTimeout_Countdown"))},btns:[{text:"Extend my Session",theme:"blue",onClick:function(t,o){return t.preventDefault(),e.options.onClickExtend(e),o.parents(".jAlert").closeAlert(),!1}},{text:"Logout Now",onClick:function(t,o){return t.preventDefault(),window.location.href=e.options.logoutUrl,!1}}]})},onClickExtend:function(e){t.get(e.options.extendUrl),e.setTimer(e.options.timeoutAfter),e.setTab(e.options.tabID),e.setTabLast()},onTimeout:function(e){t.jAlert({id:"jTimedoutAlert",title:"Oh No!",content:"<b>Your session has timed out.</b>",theme:"red",btns:{text:"Login Again",href:e.options.loginUrl,theme:"blue",closeAlert:!1},closeOnClick:!1,closeBtn:!1,closeOnEsc:!1}),t.get(e.options.logoutUrl)}}}(jQuery);
