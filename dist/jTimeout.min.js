/*
 *
 *
 jTimeout v3
 Made with love by Versatility Werks (http://flwebsites.biz)
 MIT Licensed
 *
 *
 */
!function(a){a.jTimeout=function(b){b=a.extend({},a.jTimeout.defaults,b);var c={timedOut:!1,timeoutWarning:!1,generateUid:function(a){function c(){return(65536*(1+Math.random())|0).toString(16).substring(1)}var b=a||"-";return c()+c()+b+c()+b+c()+b+c()+b+c()+c()+c()},getTimer:function(){return window.localStorage.getItem("timeoutCountdown")},setTimer:function(a){return window.localStorage.setItem("timeoutCountdown",a)},getTab:function(){return window.localStorage.getItem("timeoutTab")},setTab:function(a){return window.localStorage.setItem("timeoutTab",a)},getTabLast:function(){return window.localStorage.getItem("timeoutTabLast")},setTabLast:function(){return window.localStorage.setItem("timeoutTabLast",new Date)},stopPriorCountdown:function(){c.priorCountDown&&(c.priorCountDown=!1)},resetOnAlert:function(){return b.triggerResetOnAlert?0==a("#jTimedoutAlert").length&&b.triggerResetOnAlert:0==a("#jTimeoutAlert").length&&0==a("#jTimedoutAlert").length},stopFlashing:function(){b.flashTitle&&(c.flashingTitle&&window.clearInterval(c.flashingTitle),c.flashingTitle=!1,document.title=b.originalTitle)},startFlashing:function(){!c.flashingTitle&&b.flashTitle&&(c.flashingTitle=window.setInterval(function(){document.title==b.flashingTitleText?document.title=b.originalTitle:document.title=b.flashingTitleText},b.flashTitleSpeed))},startPriorCountdown:function(a){c.priorCountDown=a},hideCountdownAlert:function(){c.timeoutWarning=!1;var b=a("#jTimeoutAlert");b.length>0&&b.closeAlert()},countdown:function(){var d=c.getTimer(),e=c.getTab(),f=c.getTabLast();f<new Date("-2 seconds")&&(d-=Math.abs(((new Date).getTime()-f.getTime())/1e3),e=b.tabID,c.setTab(e)),c.priorCountDown&&c.priorCountDown.text(d),e==b.tabID&&(d-=b.heartbeat,c.setTabLast(),c.setTimer(d)),d<0&&!c.timedOut?(c.timeoutWarning=!0,c.timedOut=!0,b.onTimeout?b.onTimeout(c):(a.jAlert({id:"jTimedoutAlert",title:"Oh No!",content:"<b>Your session has timed out.</b>",theme:"red",btns:{text:"Login Again",href:b.loginUrl,theme:"blue",closeAlert:!1},closeOnClick:!1,closeBtn:!1,closeOnEsc:!1}),a.get(b.logoutUrl))):d<b.secondsPrior&&!c.timeoutWarning?(c.timeoutWarning=!0,c.startFlashing(),b.onPriorCallback?b.onPriorCallback(c):a.jAlert({id:"jTimeoutAlert",title:"Oh No!",content:'<b>Your session will timeout in <span class="jTimeout_Countdown">'+d+"</span> seconds!</b>",theme:"red",closeBtn:!1,onOpen:function(a){c.startPriorCountdown(a.find(".jTimeout_Countdown"))},btns:[{text:"Extend my Session",theme:"blue",onClick:function(d,e){return d.preventDefault(),b.onClickExtend?b.onClickExtend(c):(a.get(b.extendUrl),c.setTimer(b.timeoutAfter),c.setTab(b.tabID),c.setTabLast()),e.parents(".jAlert").closeAlert(),!1}},{text:"Logout Now",onClick:function(a,c){return a.preventDefault(),window.location.href=b.logoutUrl,!1}}]})):d>=b.secondsPrior&&c.timeoutWarning&&(c.stopFlashing(),c.stopPriorCountdown(),c.hideCountdownAlert())}};b.tabID||(b.tabID=c.generateUid()),c.setTimer(b.timeoutAfter),c.setTab(b.tabID),c.setTabLast();var d=1e3*b.heartbeat;return setInterval(c.countdown,d),b.extendOnMouseMove&&(d=1e3*b.mouseDebounce,c.mouseMoved=!1,window.setTimeout(function(){a("body").on("mousemove",function(){!c.mouseMoved&&c.resetOnAlert()&&(c.mouseMoved=!0,window.setTimeout(function(){c.mouseMoved=!1},d),c.onMouseMove?b.onMouseMove():(a.get(b.extendUrl),c.setTimer(b.timeoutAfter),c.setTab(b.tabID),c.setTabLast()))})},d)),c},a.jTimeout.reset=function(b){b="undefined"!=typeof b?b:a.jTimeout.defaults.timeoutAfter,window.localStorage.timeoutCountdown=b},a.jTimeout.defaults={flashTitle:!0,flashTitleSpeed:500,flashingTitleText:"**WARNING**",originalTitle:document.title,tabID:!1,timeoutAfter:1440,heartbeat:1,extendOnMouseMove:!0,mouseDebounce:30,onMouseMove:!1,extendUrl:"/dashboard",logoutUrl:"/logout",loginUrl:"/login",secondsPrior:60,triggerResetOnAlert:!1,onPriorCallback:!1,onClickExtend:!1,onTimeout:!1}}(jQuery);